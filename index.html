<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For My Queen</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;600&family=Amiri:ital,wght@1,700&display=swap" rel="stylesheet">

    <style>
        :root { 
            --bg-color: #0d001a; 
            --accent: #e0aaff; 
            --glass: rgba(255, 255, 255, 0.08);
            --gold: #ffd700;
            --error: #ff4d4d;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        html, body { 
            height: 100%; width: 100%; 
            overflow: hidden; 
            background: var(--bg-color); 
            font-family: 'Poppins', sans-serif; 
            color: white; 
        }

        .background-particles { position: fixed; inset: 0; background: linear-gradient(135deg, #1a0033 0%, #0d001a 100%); z-index: -1; }

        /* Ø´Ø±ÙŠØ· Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù„Ù‚Ø§Ø¡ - ØªØµØºÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ù„Ù„Ø¬ÙˆØ§Ù„ */
        #since-counter {
            position: fixed; top: 0; width: 100%; padding: 6px 2px;
            font-size: 10px; color: var(--accent); text-align: center;
            background: rgba(224, 170, 255, 0.1); border-bottom: 1px solid rgba(224, 170, 255, 0.2);
            z-index: 150; display: none; backdrop-filter: blur(5px);
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ - Ù…ØªÙ†Ø§Ø³Ù‚Ø© */
        #lock-screen { 
            position: fixed; inset: 0; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; z-index: 200; text-align: center;
            background: var(--bg-color); padding: 20px;
        }
        .main-welcome-title { font-family: 'Dancing Script', cursive; font-size: 2rem; margin-bottom: 10px; }
        .heart-icon { font-size: 50px; filter: drop-shadow(0 0 10px #e0aaff); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .lock-box input { 
            width: 100%; max-width: 250px; padding: 12px; border-radius: 50px; 
            border: 2px solid var(--accent); background: var(--glass); 
            color: white; text-align: center; outline: none; margin-top: 20px; font-size: 14px;
        }
        .shake { animation: shake 0.4s ease-in-out; border-color: var(--error) !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - ØªÙˆØ²ÙŠØ¹ Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .main-content { 
            display: none; width: 100%; height: 100dvh; /* dvh Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„ */
            flex-direction: column; align-items: center; 
            padding: 40px 15px 15px 15px;
        }

        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø²ÙˆØ§Ø¬ - Ø¶ØºØ· Ø§Ù„Ø­Ø¬Ù… Ù„Ù„Ø¬ÙˆØ§Ù„ */
        #wedding-box { width: 100%; max-width: 400px; margin-bottom: 10px; }
        .wedding-container {
            background: var(--glass); border: 1px solid rgba(224, 170, 255, 0.2);
            border-radius: 15px; padding: 8px; text-align: center;
        }
        .wedding-title { font-family: 'Dancing Script', cursive; font-size: 1rem; color: var(--gold); margin-bottom: 5px; }
        .timer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .timer-unit { background: rgba(0,0,0,0.3); padding: 5px 2px; border-radius: 8px; }
        .unit-val { font-size: 14px; font-weight: 600; display: block; }
        .unit-label { font-size: 8px; color: var(--accent); text-transform: uppercase; }

        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù‚Ø´Ø· - ÙŠØ£Ø®Ø° Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ø¨Ø¯Ù‚Ø© */
        .scratch-outer { 
            position: relative; width: 100%; max-width: 400px; 
            flex: 1; /* Ø§Ù„ØªÙ…Ø¯Ø¯ Ù„Ù…Ù„Ø¡ Ø§Ù„ÙØ±Ø§Øº */
            margin: 10px 0; background: #fff; border-radius: 20px; 
            overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            min-height: 150px; /* Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø¹Ø¯Ù… Ø§Ù„Ø§Ø®ØªÙØ§Ø¡ */
        }
        .message-under { 
            width: 100%; height: 100%; padding: 15px; color: #1a0033; 
            display: flex; flex-direction: column; justify-content: center; 
            align-items: center; text-align: center; opacity: 0; transition: 0.5s;
        }
        #daily-message { font-size: 14px; font-weight: 600; color: #2e004e; margin-bottom: 8px; line-height: 1.3; }
        #daily-translation { font-family: 'Amiri', serif; font-size: 18px; color: #5a189a; border-top: 1px dashed #ccc; padding-top: 8px; direction: rtl; }
        
        #scratch-canvas { position: absolute; inset: 0; z-index: 10; cursor: crosshair; touch-action: none; width: 100%; height: 100%; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
        .nav-column { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; 
            width: 100%; max-width: 400px; margin-top: 5px;
        }
        .nav-btn { background: var(--glass); border: 1px solid rgba(224, 170, 255, 0.2); color: white; padding: 12px; border-radius: 12px; font-size: 12px; }
        #today-btn { grid-column: span 2; background: linear-gradient(45deg, #7b2cbf, #9d4edd); border: none; font-weight: 600; }

        .shining-text {
            background: linear-gradient(to right, #e0aaff 20%, #fff 50%, #e0aaff 80%);
            background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: shine 4s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }
    </style>
</head>
<body>

    <div class="background-particles"></div>
    <div id="since-counter">Loading...</div>

    <div id="lock-screen">
        <h1 class="main-welcome-title shining-text">For My Queen</h1>
        <div class="heart-icon">ğŸ’œ</div>
        <div class="lock-box">
            <input type="password" id="pass-input" placeholder="Enter Secret Key" autocomplete="off">
            <p id="error-msg" style="color:var(--error); font-size:11px; margin-top:8px; display:none;">Wrong Key, Try Again ğŸ’œ</p>
        </div>
    </div>

    <div class="main-content" id="main-content">
        <div id="wedding-box">
            <div class="wedding-container">
                <div class="wedding-title">ğŸ’ Our Big Day: 13.01.2026</div>
                <div class="timer-grid">
                    <div class="timer-unit"><span class="unit-val" id="w-days">00</span><span class="unit-label">Days</span></div>
                    <div class="timer-unit"><span class="unit-val" id="w-hours">00</span><span class="unit-label">Hrs</span></div>
                    <div class="timer-unit"><span class="unit-val" id="w-mins">00</span><span class="unit-label">Min</span></div>
                    <div class="timer-unit"><span class="unit-val" id="w-secs">00</span><span class="unit-label">Sec</span></div>
                </div>
            </div>
        </div>

        <h2 id="daily-title" class="shining-text" style="font-family: 'Dancing Script'; font-size: 1.3rem;">Magic Message</h2>
        
        <div class="scratch-outer" id="scratch-box">
            <div class="message-under" id="msg-container">
                <span id="daily-message"></span>
                <span id="daily-translation"></span>
            </div>
            <canvas id="scratch-canvas"></canvas>
        </div>

        <div class="nav-column">
            <button class="nav-btn" id="today-btn" onclick="goBackToToday()">Today's Mystery ğŸ’œ</button>
            <button class="nav-btn" onclick="changeDate(-1)">â† Older</button>
            <button class="nav-btn" onclick="changeDate(1)">Newer â†’</button>
        </div>
    </div>

    <script>
        const SB_URL = "https://ojghxuemcayanfdnyyqc.supabase.co";
        const SB_KEY = "sb_publishable_aoLWIIzPn7P7o2HQSVxjmQ_fihINQg2";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        let correctPass = "";
        let displayedDate = new Date();
        const realTodayStr = new Date().toISOString().split('T')[0];

        const canvas = document.getElementById('scratch-canvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        function runSinceTimer() {
            const start = new Date("2025-10-03T16:18:00").getTime();
            setInterval(() => {
                const diff = new Date().getTime() - start;
                const d = Math.floor(diff / 86400000);
                const h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                document.getElementById('since-counter').innerHTML = `My Life Started: <b>${d}d ${h}h ${m}m ${s}s</b> ğŸ’œ`;
            }, 1000);
        }

        function runWeddingTimer() {
            const weddingDate = new Date("2026-01-13T00:00:00");
            setInterval(() => {
                const diff = weddingDate.getTime() - new Date().getTime();
                if (diff > 0) {
                    document.getElementById("w-days").innerText = Math.floor(diff / 86400000);
                    document.getElementById("w-hours").innerText = Math.floor((diff % 86400000) / 3600000);
                    document.getElementById("w-mins").innerText = Math.floor((diff % 3600000) / 60000);
                    document.getElementById("w-secs").innerText = Math.floor((diff % 60000) / 1000);
                }
            }, 1000);
        }

        function setupCanvas() {
            const box = document.getElementById('scratch-box');
            canvas.width = box.offsetWidth; 
            canvas.height = box.offsetHeight;
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = '#e0aaff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#5a189a";
            ctx.font = "bold 14px Poppins";
            ctx.textAlign = "center";
            ctx.fillText("Scratch for Love ğŸ’œ", canvas.width/2, canvas.height/2);
            document.getElementById('msg-container').style.opacity = "1";
        }

        async function loadData(dateObj) {
            document.getElementById('msg-container').style.opacity = "0";
            const dateStr = dateObj.toISOString().split('T')[0];
            const { data } = await _supabase.from('messages').select('*').eq('date', dateStr).single();
            if (data) {
                document.getElementById('daily-title').innerText = data.title;
                document.getElementById('daily-message').innerText = data.message;
                document.getElementById('daily-translation').innerText = data.translation;
                if(dateStr === realTodayStr) { correctPass = String(data.password).trim(); }
                setTimeout(setupCanvas, 150);
            }
        }

        document.getElementById('pass-input').addEventListener('input', function() {
            if (this.value.trim() === correctPass) {
                document.getElementById('lock-screen').style.display = 'none';
                document.getElementById('main-content').style.display = 'flex';
                document.getElementById('since-counter').style.display = 'block';
                runSinceTimer(); runWeddingTimer(); setupCanvas();
            } else if (this.value.length >= correctPass.length && correctPass !== "") {
                this.classList.add('shake');
                document.getElementById('error-msg').style.display = 'block';
                setTimeout(() => { this.classList.remove('shake'); this.value = ""; }, 400);
            }
        });

        function scratch(e) {
            if (!drawing) return;
            const r = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top;
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath(); ctx.arc(x, y, 30, 0, Math.PI*2); ctx.fill();
        }

        canvas.addEventListener('mousedown', () => drawing = true);
        canvas.addEventListener('touchstart', () => drawing = true);
        window.addEventListener('mouseup', () => drawing = false);
        window.addEventListener('touchend', () => drawing = false);
        canvas.addEventListener('mousemove', scratch);
        canvas.addEventListener('touchmove', (e) => { scratch(e); e.preventDefault(); }, {passive: false});

        function changeDate(n) { displayedDate.setDate(displayedDate.getDate() + n); loadData(displayedDate); }
        function goBackToToday() { displayedDate = new Date(); loadData(displayedDate); }

        loadData(new Date());
        window.addEventListener('resize', setupCanvas);
    </script>
</body>
</html>
