<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For My Queen | Eternal Love</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;600&family=Amiri:ital,wght@1,700&display=swap" rel="stylesheet">

    <style>
        :root { 
            --bg-color: #0d001a; 
            --accent: #e0aaff; 
            --glass: rgba(255, 255, 255, 0.08);
            --gold: #ffd700;
            --error: #ff4d4d;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        html, body { height: 100vh; width: 100vw; overflow: hidden; background: var(--bg-color); font-family: 'Poppins', sans-serif; color: white; }

        .background-particles { position: fixed; inset: 0; background: linear-gradient(135deg, #1a0033 0%, #0d001a 100%); z-index: -1; }

        #since-counter {
            position: fixed; top: 0; width: 100%; padding: 8px 5px;
            font-size: clamp(0.7rem, 2vw, 0.85rem); color: var(--accent); text-align: center;
            background: rgba(224, 170, 255, 0.1); border-bottom: 1px solid rgba(224, 170, 255, 0.2);
            z-index: 150; display: none; backdrop-filter: blur(5px);
        }

        #lock-screen { 
            position: fixed; inset: 0; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; z-index: 200; text-align: center;
            background: var(--bg-color); transition: 0.5s;
        }
        .main-welcome-title { font-family: 'Dancing Script', cursive; font-size: clamp(2.2rem, 8vw, 3.5rem); }
        .heart-icon { font-size: 60px; filter: drop-shadow(0 0 15px #e0aaff); animation: pulse 2s infinite; margin: 20px 0; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .lock-box input { 
            width: 280px; padding: 15px; border-radius: 50px; 
            border: 2px solid var(--accent); background: var(--glass); 
            color: white; text-align: center; outline: none; font-size: 1rem;
        }
        .shake { animation: shake 0.4s ease-in-out; border-color: var(--error) !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

        .main-content { 
            display: none; width: 100%; height: 100vh; flex-direction: column; align-items: center; 
            padding: 60px 20px 20px 20px; justify-content: space-between;
        }

        #wedding-box { width: 100%; max-width: 500px; }
        .wedding-container {
            background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
            border: 1px solid rgba(224, 170, 255, 0.2); border-radius: 20px; padding: 12px;
            text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .wedding-title { font-family: 'Dancing Script', cursive; font-size: 1.2rem; color: var(--gold); margin-bottom: 8px; }
        .timer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .timer-unit { background: rgba(0,0,0,0.4); padding: 8px 2px; border-radius: 12px; }
        .unit-val { font-size: 1.1rem; font-weight: 600; }
        .unit-label { font-size: 0.55rem; color: var(--accent); text-transform: uppercase; display: block; }

        /* ÿµŸÜÿØŸàŸÇ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÖÿ∏ŸÑŸÑ */
        .scratch-outer { 
            position: relative; width: 100%; max-width: 500px; flex-grow: 1; 
            margin: 15px 0; background: #fff; border-radius: 25px; overflow: hidden; 
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5); max-height: 45vh;
        }
        /* ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸÉŸàŸÜ ŸÖÿÆŸÅŸäÿ© ŸÅŸä ÿßŸÑÿ®ÿØÿßŸäÿ© */
        .message-under { 
            width: 100%; height: 100%; padding: 25px; color: #1a0033; 
            display: flex; flex-direction: column; justify-content: center; 
            align-items: center; text-align: center; background: white;
            opacity: 0; transition: opacity 0.5s;
        }
        #daily-message { font-size: 1rem; font-weight: 600; color: #2e004e; margin-bottom: 10px; }
        #daily-translation { font-family: 'Amiri', serif; font-size: 1.3rem; color: #5a189a; border-top: 1px dashed #ccc; padding-top: 10px; direction: rtl; }
        
        #scratch-canvas { position: absolute; inset: 0; z-index: 10; cursor: crosshair; touch-action: none; width: 100%; height: 100%; }

        .nav-column { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 500px; padding-bottom: 10px; }
        .nav-btn { background: var(--glass); border: 1px solid rgba(224, 170, 255, 0.2); color: white; padding: 15px; border-radius: 15px; font-size: 0.85rem; }
        #today-btn { grid-column: span 2; background: linear-gradient(45deg, #7b2cbf, #9d4edd); border: none; font-weight: 600; }

        .shining-text {
            background: linear-gradient(to right, #e0aaff 20%, #fff 50%, #e0aaff 80%);
            background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: shine 4s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }
    </style>
</head>
<body>

    <div class="background-particles"></div>
    <div id="since-counter">Loading...</div>

    <div id="lock-screen">
        <h1 class="main-welcome-title shining-text">For My Queen</h1>
        <div class="heart-icon">üíú</div>
        <div class="lock-box">
            <input type="password" id="pass-input" placeholder="Enter Secret Key" autocomplete="off">
            <p id="error-msg" style="color:var(--error); font-size:0.75rem; margin-top:10px; display:none; font-weight: 600;">Wrong Key, My Queen! üíú</p>
        </div>
    </div>

    <div class="main-content" id="main-content">
        <div id="wedding-box">
            <div class="wedding-container">
                <div class="wedding-title">üíç Our Big Day: 13.01.2026</div>
                <div class="timer-grid">
                    <div class="timer-unit"><span class="unit-val" id="w-days">00</span><span class="unit-label">Days</span></div>
                    <div class="timer-unit"><span class="unit-val" id="w-hours">00</span><span class="unit-label">Hrs</span></div>
                    <div class="timer-unit"><span class="unit-val" id="w-mins">00</span><span class="unit-label">Min</span></div>
                    <div class="timer-unit"><span class="unit-val" id="w-secs">00</span><span class="unit-label">Sec</span></div>
                </div>
            </div>
        </div>

        <h2 id="daily-title" class="shining-text" style="font-family: 'Dancing Script'; font-size: 1.6rem;">Magic Message</h2>
        
        <div class="scratch-outer" id="scratch-box">
            <div class="message-under" id="msg-container">
                <span id="daily-message"></span>
                <span id="daily-translation"></span>
            </div>
            <canvas id="scratch-canvas"></canvas>
        </div>

        <div class="nav-column">
            <button class="nav-btn" id="today-btn" onclick="goBackToToday()">Today's Mystery üíú</button>
            <button class="nav-btn" onclick="changeDate(-1)">‚Üê Older</button>
            <button class="nav-btn" onclick="changeDate(1)">Newer ‚Üí</button>
        </div>
    </div>

    <script>
        const SB_URL = "https://ojghxuemcayanfdnyyqc.supabase.co";
        const SB_KEY = "sb_publishable_aoLWIIzPn7P7o2HQSVxjmQ_fihINQg2";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        let correctPass = "";
        let displayedDate = new Date();
        const realTodayStr = new Date().toISOString().split('T')[0];

        const canvas = document.getElementById('scratch-canvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        function runSinceTimer() {
            const start = new Date("2025-10-03T16:18:00").getTime();
            setInterval(() => {
                const diff = new Date().getTime() - start;
                const d = Math.floor(diff / 86400000);
                const h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                document.getElementById('since-counter').innerHTML = `The moment my life changed forever <b>${d}d ${h}h ${m}m ${s}s</b> üíú`;
            }, 1000);
        }

        function runWeddingTimer() {
            const weddingDate = new Date("2026-01-13T00:00:00");
            const hideDate = new Date("2026-01-14T00:00:00");
            setInterval(() => {
                const now = new Date();
                if (now >= hideDate) { document.getElementById("wedding-box").style.display = "none"; return; }
                document.getElementById("wedding-box").style.display = "block";
                const diff = weddingDate.getTime() - now.getTime();
                if (diff > 0) {
                    document.getElementById("w-days").innerText = Math.floor(diff / 86400000);
                    document.getElementById("w-hours").innerText = Math.floor((diff % 86400000) / 3600000);
                    document.getElementById("w-mins").innerText = Math.floor((diff % 3600000) / 60000);
                    document.getElementById("w-secs").innerText = Math.floor((diff % 60000) / 1000);
                }
            }, 1000);
        }

        function setupCanvas() {
            const box = document.getElementById('scratch-box');
            canvas.width = box.offsetWidth; 
            canvas.height = box.offsetHeight;
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = '#e0aaff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#5a189a";
            ctx.font = "bold 16px Poppins";
            ctx.textAlign = "center";
            ctx.fillText("Scratch for Love üíú", canvas.width/2, canvas.height/2);
            // ÿ®ÿπÿØ ÿ±ÿ≥ŸÖ ÿßŸÑÿ™ÿ∏ŸÑŸäŸÑÿå ŸÜÿ∏Ÿáÿ± ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© (ÿ≥Ÿäÿ®ŸÇŸâ ŸÖÿÆŸÅŸäÿßŸã ÿ®ÿµÿ±ŸäÿßŸã ÿ™ÿ≠ÿ™ ÿßŸÑŸÉÿßŸÜŸÅÿßÿ≥)
            document.getElementById('msg-container').style.opacity = "1";
        }

        async function loadData(dateObj) {
            document.getElementById('msg-container').style.opacity = "0"; // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ŸÇÿ®ŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
            const dateStr = dateObj.toISOString().split('T')[0];
            const { data } = await _supabase.from('messages').select('*').eq('date', dateStr).single();
            if (data) {
                document.getElementById('daily-title').innerText = data.title;
                document.getElementById('daily-message').innerText = data.message;
                document.getElementById('daily-translation').innerText = data.translation;
                if(dateStr === realTodayStr) { correctPass = String(data.password).trim(); }
                setTimeout(setupCanvas, 100); // ÿ±ÿ≥ŸÖ ÿßŸÑÿ™ÿ∏ŸÑŸäŸÑ ŸÅŸàÿ±ÿßŸã
            }
        }

        document.getElementById('pass-input').addEventListener('input', function() {
            const val = this.value.trim();
            if (val === correctPass) {
                document.getElementById('lock-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('lock-screen').style.display = 'none';
                    document.getElementById('main-content').style.display = 'flex';
                    document.getElementById('since-counter').style.display = 'block';
                    runSinceTimer(); runWeddingTimer();
                    setupCanvas(); // ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ±ÿ≥ŸÖ ÿ®ÿπÿØ ŸÅÿ™ÿ≠ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                }, 400);
            } else if (val.length >= correctPass.length && correctPass !== "") {
                this.classList.add('shake');
                document.getElementById('error-msg').style.display = 'block';
                setTimeout(() => { this.classList.remove('shake'); this.value = ""; }, 400);
            }
        });

        function scratch(e) {
            if (!drawing) return;
            const r = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top;
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath(); ctx.arc(x, y, 40, 0, Math.PI*2); ctx.fill();
        }

        canvas.addEventListener('mousedown', () => drawing = true);
        canvas.addEventListener('touchstart', () => drawing = true);
        window.addEventListener('mouseup', () => drawing = false);
        window.addEventListener('touchend', () => drawing = false);
        canvas.addEventListener('mousemove', scratch);
        canvas.addEventListener('touchmove', (e) => { scratch(e); e.preventDefault(); }, {passive: false});

        function changeDate(n) { displayedDate.setDate(displayedDate.getDate() + n); loadData(displayedDate); }
        function goBackToToday() { displayedDate = new Date(); loadData(displayedDate); }

        loadData(new Date());
        window.addEventListener('resize', setupCanvas);
    </script>
</body>
</html>
